# Auth Service

## Цель
Микросервис для управления пользователями и авторизацией в SkillUp.

## Технологии
- Laravel 11+ (PHP 8.3+)
- PostgreSQL 15+
- Redis 7+
- RabbitMQ 3.12+
- JWT + Refresh Tokens

## Функционал

### Аутентификация
- Регистрация по email/password
- JWT токены (access: 15min, refresh: 7 дней)
- Сброс пароля через email
- Подтверждение email
- Rate limiting

### Авторизация
- Роли: user, admin
- Проверка прав доступа
- Logout с блокировкой токенов

## API

### Публичные
```
POST /api/v1/auth/register
POST /api/v1/auth/login
POST /api/v1/auth/refresh
POST /api/v1/auth/forgot-password
POST /api/v1/auth/reset-password
POST /api/v1/auth/verify-email/{token}
```

### Защищенные
```
GET    /api/v1/auth/me
POST   /api/v1/auth/logout
PUT    /api/v1/auth/profile
PUT    /api/v1/auth/password
```

### Админ
```
GET    /api/v1/admin/users
PUT    /api/v1/admin/users/{id}/role
POST   /api/v1/admin/users/{id}/ban
```

## База данных

### users
```sql
id              BIGSERIAL PRIMARY KEY
name            VARCHAR(255) NOT NULL
email           VARCHAR(255) UNIQUE NOT NULL
password_hash   VARCHAR(255) NOT NULL
role            VARCHAR(20) DEFAULT 'user'
is_active       BOOLEAN DEFAULT true
email_verified_at TIMESTAMP NULL
last_login_at   TIMESTAMP NULL
created_at      TIMESTAMP DEFAULT NOW()
updated_at      TIMESTAMP DEFAULT NOW()
```

### refresh_tokens
```sql
id         BIGSERIAL PRIMARY KEY
user_id    BIGINT REFERENCES users(id) ON DELETE CASCADE
token_hash VARCHAR(255) UNIQUE NOT NULL
expires_at TIMESTAMP NOT NULL
created_at TIMESTAMP DEFAULT NOW()
```

### password_resets
```sql
email      VARCHAR(255) NOT NULL
token      VARCHAR(255) UNIQUE NOT NULL
expires_at TIMESTAMP NOT NULL
created_at TIMESTAMP DEFAULT NOW()
```

## События RabbitMQ

### UserRegistered
```json
{
  "user_id": 123,
  "email": "user@example.com",
  "role": "user",
  "name": "John Doe"
}
```

### UserLoggedIn
```json
{
  "user_id": 123,
  "ip_address": "192.168.1.1"
}
```

## Безопасность
- Пароли: минимум 6 символов, bcrypt хеширование
- Rate limiting: 5 попыток входа/минуту
- JWT токены с коротким временем жизни
- CORS настройки